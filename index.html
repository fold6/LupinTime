<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LupinTime</title>
    <link href="https://fonts.googleapis.com/css2?family=Pretendard&display=swap" rel="stylesheet" />
    <style>
        * {
            box-sizing: border-box;
            font-family: 'Pretendard', sans-serif;
        }

        body {
            margin: 0;
            background: #1F2125;
            color: #fff;
        }

        input:focus {
            outline: 1px solid #666;
        }

        .page {
            display: none;
            padding: 30px;
            max-width: 768px;
            margin: 0 auto;
            margin-top: 40px;
        }

        .topbar {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .back-btn {
            background: none;
            border: none;
            color: #ccc;
            font-size: 24px;
            cursor: pointer;
        }

        .active {
            display: block;
        }

        h2 {
            font-size: 25px;
            margin-bottom: 10px;
        }

        .desc {
            font-size: 14px;
            color: #888;
            margin-bottom: 90px;

        }

        label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 30px 0;
            font-size: 16px;
            color: #ccc;
        }

        input[type="number"],
        input[type="text"] {
            background: #3D3F46;
            border: none;
            color: #fff;
            padding: 10px;
            border-radius: 10px;
            width: 120px;
            text-align: right;
            margin-right: 5px;
            font-weight: 600;
            font-size: 16px;
        }

        .unit {
            color: #888;
        }

        .btn {
            width: calc(100% - 30px);
            background: #7f5af0;
            color: #000;
            font-weight: bold;
            border: none;
            padding: 15px;
            text-align: center;
            border-radius: 10px;
            /* margin-top: 30px; */
            cursor: pointer;
            position: absolute;
            bottom: 40px;
            left: 50%;
            transform: translate(-50%);
            transition: .2s;
            font-size: 18px;
            font-weight: 600;
            max-width: 768px;
        }

        .btn:hover {
            background-color: #916cff;
            transition: .2s;
        }

        .btn:disabled {
            background: #323439;
            color: #666;
            cursor: not-allowed;
        }

        .toggle {
            background: #7f5af0;
            color: #1F2125;
            border-radius: 15px;
            padding: 15px 15px;
            font-size: 16px;
            font-weight: 800;
            cursor: pointer;
        }

        #skipToStep2 {
            bottom: 115px;
            border: 1px solid #7f5af0;
            color: #7f5af0;
            background: #33333300;
            font-weight: 400;
        }

        .summary-box {
            background: radial-gradient(circle, #7f5af0, #000);
            text-align: center;
            padding: 40px 20px;
            border-radius: 50%;
            margin: 30px auto;
            width: 260px;
            height: 260px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .summary-box .amount {
            font-size: 28px;
            font-weight: bold;
        }

        .row {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
        }

        .row button {
            background: #7f5af0;
            border: none;
            color: #fff;
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 14px;
            cursor: pointer;
        }

        .add-btn {
            background: #7f5af0;
            color: #000;
            font-weight: bold;
            border: none;
            padding: 15px;
            text-align: center;
            width: 100%;
            border-radius: 10px;
            margin-top: 30px;
            cursor: pointer;
            transition: .2s;
        }

        .add-btn:hover {
            background-color: #916cff;
            transition: .2s;
        }
    </style>
</head>

<body>

    <!-- Step 1 -->
    <div class="page" id="page1">
        <h2>급여 정보를 알려주세요</h2>
        <div class="desc">나중에 얼마든지 바꿀 수 있어요</div>
        <label>연봉 <span class="unit"><input type="number" id="salary" /> 만원</span></label>
        <label>일일 근무시간 <span class="unit"><input type="number" id="dailyHours" /> 시간</span></label>
        <label>일주 근무일수 <span class="unit"><input type="number" id="weeklyDays" /> 일</span></label>
        <label>세금적용 <span id="taxToggle" class="toggle">4대보험</span></label>
        <button class="btn" id="skipToStep2">바로 월급 적기</button>
        <button class="btn" id="toStep2" disabled>다음</button>
    </div>

    <!-- Step 2 -->
    <div class="page" id="page2">
        <div class="topbar">
            <button class="back-btn" id="backBtn">&larr;</button>
        </div>
        <div class="desc">나의 월급은?</div>
        <input type="text" id="netSalary"
            style="font-size:24px; background:#3D3F46; color:#fff; border:none; border-radius:10px; padding:15px; text-align:right; width:100%;" />
        <div style="text-align:center; margin-top:15px;">위 금액을 기준으로 루팡타임이 시작돼요!</div>
        <button class="btn" id="toStep3">다음</button>
    </div>

    <!-- Step 3 -->
    <div class="page" id="page3">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h2>LupinTime</h2>
            <button id="edit" style="color:#888; background:none; border:none; cursor:pointer;">급여수정</button>
        </div>
        <div class="summary-box">
            <div class="amount" id="earned">0 원</div>
            <div style="font-size:14px; color:#ccc;">/ <span id="base">0</span> 원</div>
        </div>
        <div style="text-align:center; color:#888; font-size:14px;">
            월급의 <span id="percent">0%</span>를 루팡했어요!
        </div>
        <label>루팡한 시간 <span class="unit"><input type="number" id="lupinMin" value="10" />분</span></label>
        <div class="row">
            <button class="add-btn" data-min="3">+ 3분</button>
            <button class="add-btn" data-min="5">+ 5분</button>
            <button class="add-btn" data-min="10">+ 10분</button>
        </div>
        <button class="btn" id="calculate">계산하기</button>
    </div>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script>
        const storageKey = 'lupinData';
        let taxRate = 0.094;
        let taxOn = true;

        function validateStep1() {
            const filled = $('#salary').val() && $('#dailyHours').val() && $('#weeklyDays').val();
            $('#toStep2').prop('disabled', !filled);
        }

        function calculateNet(salary, useTax) {
            const yearly = salary * 10000;
            return useTax ? Math.floor(yearly * (1 - taxRate) / 12) : Math.floor(yearly / 12);
        }

        function formatNumberInput(input) {
            const value = input.value.replace(/[^0-9]/g, '');
            input.value = Number(value).toLocaleString();
            return Number(value);
        }

        function calculateLupinEarned(min, net, hoursPerDay, daysPerWeek) {
            const monthlyMinutes = hoursPerDay * daysPerWeek * 4.345 * 60;
            const perMinute = net / monthlyMinutes;
            return Math.floor(perMinute * min);
        }

        function saveAndGoToStep3() {
            const netVal = $('#netSalary').val().replace(/,/g, '');
            const data = {
                net: parseInt(netVal, 10),
                hoursPerDay: parseInt($('#dailyHours').val(), 10) || 8,
                daysPerWeek: parseInt($('#weeklyDays').val(), 10) || 5
            };
            localStorage.setItem(storageKey, JSON.stringify(data));
            $('#base').text(data.net.toLocaleString());
            $('#page2').removeClass('active');
            $('#page3').addClass('active');
            window.saved = data;
        }

        $(function () {
            window.saved = JSON.parse(localStorage.getItem(storageKey));
            if (window.saved) {
                $('#page3').addClass('active');
                $('#base').text(window.saved.net.toLocaleString());
            } else {
                $('#page1').addClass('active');
            }

            $('#salary, #dailyHours, #weeklyDays').on('input', validateStep1);

            $('#taxToggle').on('click', function () {
                taxOn = !taxOn;
                $(this).text(taxOn ? '4대보험' : '세전');
                $(this).css('background', taxOn ? '#7f5af0' : '#444');
            });

            function validateStep2() {
                const net = parseInt($('#netSalary').val().replace(/,/g, ''), 10);
                $('#toStep3').prop('disabled', !(net > 0));
            }
            $('#netSalary').on('input', function () {
                formatNumberInput(this);
                validateStep2();
            });

            $('#toStep2').on('click', function () {
                const net = calculateNet($('#salary').val(), taxOn);
                $('#netSalary').val(net.toLocaleString());
                $('#page1').removeClass('active');
                $('#page2').addClass('active');
                validateStep2();
            });

            $('#skipToStep2').on('click', function () {
                const net = calculateNet($('#salary').val(), taxOn);
                $('#netSalary').val(net.toLocaleString());
                $('#page1').removeClass('active');

                $('#page2').addClass('active');
                validateStep2();
                const data = {
                    net: net,
                    hoursPerDay: 8,
                    daysPerWeek: 5
                };
                localStorage.setItem(storageKey, JSON.stringify(data));
                window.saved = data;
            });

            $('#toStep3').on('click', function () {
                saveAndGoToStep3();
            });

            $('.add-btn').on('click', function () {
                const cur = parseInt($('#lupinMin').val(), 10) || 0;
                const add = parseInt($(this).data('min'), 10);
                $('#lupinMin').val(cur + add);
            });

            $('#calculate').on('click', function () {
                const min = parseInt($('#lupinMin').val(), 10);
                const saved = JSON.parse(localStorage.getItem(storageKey));
                if (!saved || !saved.net || !min) return;
                const lupin = calculateLupinEarned(min, saved.net, saved.hoursPerDay, saved
                    .daysPerWeek);
                $('#earned').text(`${lupin.toLocaleString()} 원`);
                $('#percent').text(saved.net > 0 ? `${((lupin / saved.net) * 100).toFixed(1)}%` : '0%');
            });

            $('#edit').on('click', function () {
                localStorage.removeItem(storageKey);
                location.reload();
            });

            $('#backBtn').on('click', function () {
                if ($('#page2').hasClass('active')) {
                    $('#page2').removeClass('active');
                    $('#page1').addClass('active');
                } else if ($('#page3').hasClass('active')) {
                    $('#page3').removeClass('active');
                    $('#page2').addClass('active');
                }
            });
        });
    </script>
</body>

</html>
